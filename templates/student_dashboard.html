{% extends "base.html" %}

{% block title %}Student Dashboard{% endblock %}

{% block content %}
    <h1>Hello, {{ current_user.full_name }}! üëã</h1>
    <p style="color: var(--color-text-secondary); margin-bottom: 30px;">
        Welcome to your personalized learning space.
    </p>

    <div class="stat-grid">
        <div class="stat-card" style="border-top-color: var(--color-accent);">
            <h3>University</h3>
            <span class="value" style="font-size: 1.5rem; color: var(--color-accent);">{{ current_user.university.name }}</span>
        </div>
        <div class="stat-card" style="border-top-color: var(--color-primary);">
            <h3>Your Tutor</h3>
            <span class="value" style="font-size: 1.5rem;">
                {{ current_user.assigned_tutor.full_name if current_user.assigned_tutor else "N/A" }}
            </span>
        </div>
        <div class="stat-card" style="border-top-color: {{ 'var(--color-success)' if current_user.is_approved and current_user.is_paid_current_month else 'var(--color-danger)' }};">
            <h3>Access Status</h3>
            <span class="value" style="font-size: 1.5rem; color: {{ 'var(--color-success)' if current_user.is_approved and current_user.is_paid_current_month else 'var(--color-danger)' }};">
                {{ 'Active' if current_user.is_approved and current_user.is_paid_current_month else 'Pending' }}
            </span>
        </div>
    </div>
    
    {% if current_user.is_approved and current_user.is_paid_current_month %}
        <div class="flash success" style="padding: 20px; font-size: 1.1em;">
            <h2 style="color: var(--color-success); margin-bottom: 10px;">
                ‚úÖ Access Granted: {{ access_status }}
            </h2>
            <p>You currently have full, uninterrupted access to all course materials for your university.
                <a href="#" style="color: var(--color-success); font-weight: bold;">View Course Materials ‚Üí</a>
            </p>
        </div>
    {% else %}
        <div class="flash danger" style="padding: 20px; font-size: 1.1em;">
            <h2 style="color: var(--color-danger); margin-bottom: 10px;">
                ‚ùå Access Restricted: {{ access_status }}
            </h2>
            <p>Please resolve the following issues to regain full access:</p>
            <ul style="list-style-type: none; padding-left: 0;">
                {% if not current_user.is_approved %}
                <li style="margin-bottom: 8px;">
                    <strong style="color: var(--color-danger);">1. Pending Tutor Approval:</strong> Contact your tutor, {{ current_user.assigned_tutor.full_name if current_user.assigned_tutor else "N/A" }}, to complete your enrollment.
                </li>
                {% endif %}
                {% if not current_user.is_paid_current_month %}
                <li>
                    <strong style="color: var(--color-danger);">2. Pending Monthly Payment:</strong> Ensure payment is made and recorded by your tutor.
                </li>
                {% endif %}
            </ul>
        </div>
    {% endif %}

    {% if current_user.assigned_tutor and not current_user.has_reviewed_tutor %}
        <div class="card interactive" style="border-left: 5px solid var(--color-accent); margin-top: 30px;">
            <h3 style="color: var(--color-accent);">Your Feedback Matters! ‚≠ê</h3>
            <p>Help us maintain high quality. Please take a moment to review your assigned tutor.</p>
            <a href="{{ url_for('main.review_tutor', tutor_id=current_user.assigned_tutor.id) }}" class="btn btn-primary">
                Review Tutor: {{ current_user.assigned_tutor.full_name }}
            </a>
        </div>
    {% endif %}

{% endblock %}